---
title: 2023/08/04
type: blog
date: 2023-08-04
lastmod: 2023-09-28T18:41:56+09:00
categories:
  - daily
tags:
---

[å®Ÿè£…ã—ãŸæœ€çµ‚çš„ãªRingBuffer](https://gist.github.com/showa-93/ec10db8e4fdd60148e6acd61641b9192/#file-go-ringbuffer-go)  

[å¾ã€…ã«é«˜åº¦ã«ãªã‚‹ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡ã®è©± - Software Transactional Memo](https://kumagi.hatenablog.com/entry/ring-buffer)ã‚’èª­ã‚“ã§å®Ÿè£…ã—ãŸã€‚  
ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡ã®æ›¸ãè¾¼ã¿ã®ä½ç½®ã¨å‚ç…§ã®ä½ç½®ã®å…±æœ‰ã®ã‚¤ãƒ³ãƒ‡ã‚¯ã‚¹ã®èª­ã¿æ›¸ãã‚’ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã§ãŠã“ãªã†å ´åˆã€ãƒ¡ãƒ¢ãƒªã®èª­ã¿è¾¼ã¿é€Ÿåº¦ã«å½±éŸ¿ãŒå‡ºã‚‹ã€‚  
CPUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã®å˜ä½ï¼ˆ[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æƒ…å ±ã‚’èª¿ã¹ã‚‹æ–¹æ³• - teastat](https://blog.teastat.uk/post/2021/05/how-to-get-cache-info/)ï¼‰ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚  
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã”ã¨ã«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ã‚‚ã£ã¦ãŠã‚Šã€æ›¸ãæ›ãˆãŒç™ºç”Ÿã—ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã‚’åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰å‚ç…§ã™ã‚‹ã¨CPUã®ã‚³ã‚¢ã«å•ã„åˆã‚ã›ã¦ã‚¹ãƒ†ãƒ¼ãƒˆã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚  
å¤‰æ•°ã‚’è§¦ã‚‹äººãŒé™ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ã€å‚ç…§ã ã‘ã™ã‚‹å´ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸã‚¤ãƒ³ãƒ‡ã‚¯ã‚¹ã ã‘ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚‚ã¨ã¨ãªã‚‹å®Ÿç‰©ã‚’å‚ç…§ã™ã‚‹å›æ•°ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚’ã‚ã’ã‚‹ã€‚  

ãŸã ã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨å®Ÿç‰©ãŒåŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã«ã®ã‚‰ãªã„ã‚ˆã†ã«èª¿ç¯€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ï¼ˆåŒã˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã ã¨æ›¸ãè¾¼ã¿ãŒç™ºç”Ÿã—ãŸã¨ãã‚¹ãƒ†ãƒ¼ãƒˆãŒå¤‰ã‚ã£ã¦ã‚³ã‚¢ã¸ã®å•ã„åˆã‚ã›ãŒç™ºç”Ÿã™ã‚‹ã€‚ï¼‰  
Goã§ã‚„ã‚‹ãªã‚‰[CPUã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒGoã®ã‚³ãƒ¼ãƒ‰ã«ä¸ãˆã‚‹å½±éŸ¿ï¼ˆç¿»è¨³ï¼‰ï½œTechRacho by BPSæ ªå¼ä¼šç¤¾](https://techracho.bpsinc.jp/hachi8833/2020_06_24/93115)ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«æ§‹é€ ä½“ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã¨åŒã˜ã ã‘ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ç”¨æ„ã™ã‚‹ã€‚  
å€ãã‚‰ã„æ—©ããªã£ã¦ã„ã‚‹ã€‚  

> shomağŸ¥²[main]~/dev/ringbuffer ./mpmc2  
> finished benchmark. 2097152 times, elapsed 86.395465 ms, 24273.866690 op/ms  
shomağŸ¥²[main]~/dev/ringbuffer ./mpmc3  
> finished benchmark. 2097152 times, elapsed 44.432209 ms, 47198.913743 op/ms  

CPUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã“ã¨ã‚’è€ƒãˆãšã«é€šå¸¸ã®å®Ÿè£…ã‚’ã—ãŸå ´åˆã®å‘½ä»¤ã®æ•°ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã®æ•°ã€‚

```txt
==9746== I   refs:      481,381,624
==9746== I1  misses:          3,356
==9746== LLi misses:          2,115
==9746== I1  miss rate:        0.00%
==9746== LLi miss rate:        0.00%
```

æ§‹é€ ä½“ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’åŠ ãˆã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã‚’æ„è­˜ã—ãŸå®Ÿè£…ã«ã—ãŸå ´åˆã€ï¼’å€ä»¥ä¸Šã®å‘½ä»¤æ•°(I refs)ã«å¯¾ã—ã¦åŒã˜ç¨‹åº¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ã®æ•°ã®ãŸã‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ãŒå¤§ããå¢—åŠ ã—ã¦ã„ã‚‹ã€‚

```txt
==10154== I   refs:      1,153,382,268
==10154== I1  misses:            3,412
==10154== LLi misses:            2,116
==10154== I1  miss rate:          0.00%
==10154== LLi miss rate:          0.00%
```

## èª­ã‚“ã è¨˜äº‹
